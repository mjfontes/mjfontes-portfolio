!function(e){"use strict";const t={instance:[],templateId:0,init:function(){this.renderPopup(),this.reinitSelect2(),e(document).on("click","#wcf-addons-archive-display-type",this.specificsDisplay),e("body.post-type-wcf-addons-template #wpcontent").on("click",".page-title-action, .row-title, .row-actions .edit > a",this.openPopup),e(document).on("click",".wcf-addons-body-overlay,.wcf-addons-template-edit-cross",this.closePopup).on("click",".wcf-addons-tmp-save",this.savePost).on("click",".wcf-addons-tmp-elementor",this.redirectEditPage).on("wcf_template_edit_popup_open",this.displayLocation).on("change","#wcf-addons-template-type, #wcf-addons-hf-display-type",this.displayLocation),e(document).on("change","#wcf-addons--popup--builder-trigger",this.triggerChange),e("#wcf-addons-hf-s-display-type").on("select2:select",function(t){var a=e(this).val(),o=[...new Set(a)];e(this).val(o).trigger("change")})},specificsDisplay:function(t){t.preventDefault(),"specifics_cat"==e(this).val()?e(".single-category-location").removeClass("hidden"):e(".single-category-location").addClass("hidden")},reinitSelect2:function(){e("#wcf-addons-hf-s-display-type").select2({ajax:{url:ajaxurl,dataType:"json",method:"post",delay:250,data:function(e){return{q:e.term,page:e.page||1,action:"wcf_get_posts_by_query",nonce:WCF_Theme_Builder.nonce}},processResults:function(e){let t=[],a=new Set;return e.forEach(e=>{a.has(e.id)||(a.add(e.id),t.push(e))}),{results:t}},cache:!0},minimumInputLength:2,placeholder:"Search and select an option",allowClear:!0})},renderPopup:function(t){var a;a=wp.template("wcf-addons-ctppopup")({templatetype:WCF_Theme_Builder.templatetype,hflocation:WCF_Theme_Builder.hflocation,archivelocation:WCF_Theme_Builder.archivelocation,singlelocation:WCF_Theme_Builder.singlelocation,postcategory:WCF_Theme_Builder.postcategory,editor:WCF_Theme_Builder.editor,heading:WCF_Theme_Builder.labels}),e("body").append(a)},triggerChange:function(a){a.preventDefault();const o=e(this).val();t.selectorFieldDisplay(o)},selectorFieldDisplay:function(t){["click","page_scroll"].includes(t)?e("#aae-popup-builder-selector").parents(".aae-popup-builder-location").removeClass("hidden"):e("#aae-popup-builder-selector").parents(".aae-popup-builder-location").addClass("hidden")},openPopup:function(a){a.preventDefault();let o=e(this).closest("tr").attr("id"),i=null,l=null;o&&(i=o.replace("post-",""),l="post.php?post="+i+"&action=elementor"),e(".wcf-addons-tmp-save").attr("data-tmpid",i),e(".wcf-addons-tmp-elementor").attr({"data-link":l,"data-tmpid":i}),i?e.ajax({url:WCF_Theme_Builder.ajaxurl,data:{action:"wcf_get_template",nonce:WCF_Theme_Builder.nonce,tmpId:i},type:"POST",beforeSend:function(){},success:function(t){document.querySelector("#wcf-addons-template-type option[value='"+t.data.tmpType+"']").selected="true",e("#wcf-addons-template-title").attr("value",t.data.tmpTitle),e(".wcf-addons-tmp-elementor").removeClass("disabled").removeAttr("disabled","disabled")},complete:function(a){if(e("#wcf-addons-hf-s-display-type").val(null).trigger("change"),e(document).trigger("wcf_template_edit_popup_open"),"specifics_cat"===a.responseJSON.data.tmpLocation){e(".single-category-location").removeClass("hidden");let t=Object.keys(a.responseJSON.data.tmpSpLocation);e("#wcf-addons-single-category-display-type").find("option[value='"+t[0]+"']").length&&(e("#wcf-addons-single-category-display-type").find("option[value='"+t[0]+"']")[0].selected="true",e("#wcf-addons-single-category-display-type").trigger("change"))}else e(".single-category-location").addClass("hidden");e(".hf-location:visible select, .archive-location:visible select, .single-location:visible select").find("option[value='"+a.responseJSON.data.tmpLocation+"']")[0].selected="true",a.responseJSON.data.tmpSpLocation&&(e.each(a.responseJSON.data.tmpSpLocation,function(t,a){let o={id:t,text:a},i=new Option(o.text,o.id,!0,!0);e("#wcf-addons-hf-s-display-type").append(i).trigger("change")}),a.responseJSON.data.tmpType&&"popup"===a.responseJSON.data.tmpType?(e("#aae-popup-builder-delay").val(a.responseJSON.data.tmpDelay),e("#aae-popup-builder-selector").val(a.responseJSON.data.tmpSelector),e("#wcf-addons--popup--builder-trigger").val(a.responseJSON.data?.tmpTrigger).trigger("change"),e(".aae-popup-builder-location").removeClass("hidden"),t.selectorFieldDisplay(a.responseJSON.data?.tmpTrigger)):e(".aae-popup-builder-location").addClass("hidden")),e(".wcf-addons-template-edit-popup-area").addClass("open-popup")},error:function(e){console.log(e)}}):(e(document).trigger("wcf_template_edit_popup_open"),e(".wcf-addons-tmp-elementor").addClass("button disabled").attr("disabled","disabled"),e(".wcf-addons-template-edit-popup-area").addClass("open-popup"),t.getParam("template_type")&&e("#wcf-addons-template-type").val(t.getParam("template_type")).trigger("change"))},getParam:function(e,t=window.location.href){return new URL(t).searchParams.get(e)},closePopup:function(a){e(".wcf-addons-template-edit-popup-area").removeClass("open-popup"),e("#wcf-addons-hf-s-display-type").select2("destroy");e(".wcf-addons-template-edit-field.hf-s-location").html('<label class="wcf-addons-template-edit-label"></label>\n                                <select class="wcf-addons-template-edit-input" name="wcf-addons-hf-s-display-type[]"\n                                        id="wcf-addons-hf-s-display-type" multiple="multiple">\n                                </select>'),t.reinitSelect2()},savePost:function(t){const a=e(this),o=t.target.dataset.tmpid?t.target.dataset.tmpid:"",i=e("#wcf-addons-template-title").val(),l=e("#wcf-addons-template-type").val(),d=e(".hf-location:visible select, .archive-location:visible select, .single-location:visible select").val();let s=e(".hf-s-location:visible select").val();"specifics_cat"==d&&(s=[],s.push(e("#wcf-addons-single-category-display-type").val()));let n={action:"wcf_save_template",nonce:WCF_Theme_Builder.nonce,tmpId:o,title:i,tmpType:l,tmpDisplay:d,specificsDisplay:JSON.stringify(s)??null};"popup"===l&&(n.tmpDelay=e("#aae-popup-builder-delay").val()?e("#aae-popup-builder-delay").val():0,n.tmpTrigger=e("#wcf-addons--popup--builder-trigger").val()?e("#wcf-addons--popup--builder-trigger").val():"pageloaded",n.tmpSelector=e("#aae-popup-builder-selector").val()?e("#aae-popup-builder-selector").val():""),e.ajax({url:WCF_Theme_Builder.ajaxurl,data:n,type:"POST",beforeSend:function(){a.text(WCF_Theme_Builder.labels.buttons.save.saving),a.addClass("updating-message")},success:function(t){if(""==o){if(t.data.id)var a="post.php?post="+t.data.id+"&action=elementor";e(".wcf-addons-tmp-save").attr("data-tmpid",t.data.id),e(".wcf-addons-tmp-elementor").attr({"data-link":a,"data-tmpid":t.data.id}),e(".wcf-addons-tmp-elementor").removeClass("disabled").removeAttr("disabled","disabled")}},complete:function(t){e("body.post-type-woolentor-template").removeClass("loading"),a.removeClass("updating-message"),a.text(WCF_Theme_Builder.labels.buttons.save.saved)},error:function(e){console.log(e)}})},redirectEditPage:function(t){t.preventDefault();var a=e(this),o=a.data("link")?a.data("link"):"";window.location.replace(WCF_Theme_Builder.adminURL+o)},displayLocation:function(t){let a=e("#wcf-addons-template-type").val();e(".hf-s-location").addClass("hidden"),"archive"===a?(e(".archive-location").removeClass("hidden"),e(".hf-location, .single-location").addClass("hidden")):"single"===a?(e(".single-location").removeClass("hidden"),e(".hf-location, .archive-location").addClass("hidden")):(e(".hf-location").removeClass("hidden"),e(".single-location, .archive-location").addClass("hidden"),setTimeout(function(){"specifics"===e("#wcf-addons-hf-display-type").val()&&e(".hf-s-location").removeClass("hidden")},100)),"popup"===a?e(".aae-popup-builder-location").removeClass("hidden"):e(".aae-popup-builder-location").addClass("hidden")}};t.init()}(jQuery);